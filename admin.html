<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZEON BET - PATRON</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body{background:#000;color:#0f0;font-family:monospace;padding:20px;}
        .panel{max-width:1100px;margin:40px auto;background:#111;padding:40px;border:4px solid #0f0;border-radius:16px;box-shadow:0 0 40px rgba(0,255,0,0.5);}
        h1{text-align:center;font-size:42px;text-shadow:0 0 20px #0f0;}
        .box{background:#000;border:2px solid #0f0;padding:25px;border-radius:12px;margin:20px 0;}
        input,select{width:100%;padding:12px;background:#000;color:#0f0;border:1px solid #0f0;border-radius:8px;margin:8px 0;}
        .btn{background:#0f0;color:#000;padding:14px 28px;margin:10px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
        .btn-red{background:#e74c3c;color:white;}
    </style>
</head>
<body>
<div class="panel">
    <h1>ZEON BET - PATRON PANELİ</h1>
    <div id="content"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyCYXL4EEbvokEDFpC6IvAwIaiegPcxYm5Q", authDomain: "zeonbet-45f71.firebaseapp.com", projectId: "zeonbet-45f71", storageBucket: "zeonbet-45f71.firebasestorage.app", messagingSenderId: "667804601852", appId: "1:667804601852:web:3d2efa987944f5debcb679" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const PATRON_UID = "gMLnDVHGM1dPzudSotXiT525ZdF2";

    firebase.auth().onAuthStateChanged(user => {
        if (!user) location.href="giris.html";
        else if (user.uid === PATRON_UID) {
            document.getElementById("content").innerHTML = `
                <div class="box">
                    <h2>MAÇ EKLE</h2>
                    <input id="home" placeholder="Ev sahibi">
                    <input id="away" placeholder="Deplasman">
                    <input id="o1" placeholder="1 oranı" type="number" step="0.01">
                    <input id="ox" placeholder="X oranı" type="number" step="0.01">
                    <input id="o2" placeholder="2 oranı" type="number" step="0.01">
                    <button class="btn" onclick="macEkle()">EKLE</button>
                </div>
                <div class="box">
                    <h2>SONUÇ GİR</h2>
                    <select id="matchSelect"></select>
                    <div style="display:flex;gap:10px;margin-top:10px;">
                        <button class="btn" style="flex:1;" onclick="sonuc(1)">1</button>
                        <button class="btn" style="flex:1;" onclick="sonuc(0)">X</button>
                        <button class="btn" style="flex:1;" onclick="sonuc(2)">2</button>
                    </div>
                </div>
                <div style="text-align:center;margin-top:30px;">
                    <button class="btn" onclick="location.href='index.html'">ANA SAYFA</button>
                    <button class="btn btn-red" onclick="firebase.auth().signOut().then(()=>location.href='giris.html')">ÇIKIŞ</button>
                </div>
            `;
            loadMatches();
        } else {
            document.getElementById("content").innerHTML = "<h2 style='color:#e74c3c;text-align:center;'>ERİŞİM YOK</h2>";
        }
    });

    function macEkle(){
        const h=document.getElementById("home").value;
        const a=document.getElementById("away").value;
        const o1=parseFloat(document.getElementById("o1").value);
        const ox=parseFloat(document.getElementById("ox").value);
        const o2=parseFloat(document.getElementById("o2").value);
        if(h&&a&&o1&&ox&&o2){
            db.collection("matches").add({homeTeam:h,awayTeam:a,odd1:o1,oddX:ox,odd2:o2,live:true,timestamp:firebase.firestore.FieldValue.serverTimestamp()})
                .then(()=>{alert("Maç eklendi!");document.getElementById("home").value="";});
        }
    }
    function loadMatches(){
        db.collection("matches").onSnapshot(snap=>{
            const sel=document.getElementById("matchSelect");
            sel.innerHTML="<option>Maç seç</option>";
            snap.forEach(doc=>{if(doc.data().result===undefined){
                const opt=document.createElement("option");opt.value=doc.id;opt.textContent=doc.data().homeTeam+" - "+doc.data().awayTeam;sel.appendChild(opt);
            }});
        });
    }
    function sonuc(res){
        const id=document.getElementById("matchSelect").value;
        if(!id) return;
        db.collection("matches").doc(id).update({result:res,live:false}).then(()=>{
            alert("Sonuç girildi! Kazananlar ödendi.");
            payWinners(id,res);
        });
    }
    function payWinners(matchId,result){
        db.collection("bets").where("status","==","bekliyor").get().then(snap=>{
            snap.forEach(doc=>{
                const bet=doc.data();
                let win=true;
                for(let s of bet.selections){
                    if(s.matchId===matchId){
                        const correct = (result===1 && s.selection.includes("kazanır") && s.selection.includes(bet.selections.find(x=>x.matchId===matchId)?.homeTeam)) ||
                                        (result===2 && s.selection.includes("kazanır") && !s.selection.includes(bet.selections.find(x=>x.matchId===matchId)?.homeTeam)) ||
                                        (result===0 && s.selection==="Berabere");
                        if(!correct) win=false;
                    }
                }
                if(win && bet.selections.length===1){
                    db.collection("users").doc(bet.userId).update({balance:firebase.firestore.FieldValue.increment(bet.possibleWin)});
                    db.collection("bets").doc(doc.id).update({status:"kazandı"});
                } else if(!win){
                    db.collection("bets").doc(doc.id).update({status:"kaybetti"});
                }
            });
        });
    }
</script>
</body>
</html>
